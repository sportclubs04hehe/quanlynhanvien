<div class="container-fluid mt-4">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">
        <i class="bi bi-building-fill me-2"></i>Quản Lý Phòng Ban
      </h4>
    </div>
    
    <div class="card-body">
      <!-- Toolbar -->
      <div class="row mb-3">
        <div class="col-md-8">
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-search"></i>
            </span>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Tìm kiếm phòng ban..."
              [value]="searchTerm()"
              (input)="onSearchInput($any($event.target).value)"
            />
            @if (searchTerm()) {
              <button 
                class="btn btn-outline-secondary" 
                type="button"
                (click)="clearSearch()"
              >
                <i class="bi bi-x-lg"></i>
              </button>
            }
          </div>
        </div>
        <div class="col-md-4 text-end">
          <button 
            class="btn btn-success"
            (click)="openCreateModal()"
          >
            <i class="bi bi-plus-circle me-1"></i>Thêm Phòng Ban
          </button>
        </div>
      </div>

      <!-- Error Message -->
      @if (errorMessage()) {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          {{ errorMessage() }}
          <button type="button" class="btn-close" (click)="errorMessage.set(null)"></button>
        </div>
      }

      <!-- Table -->
      @if (isLoading()) {
        <div class="text-center py-5">
          <p class="mt-3 text-muted">Đang tải danh sách phòng ban...</p>
        </div>
      } @else if (phongBans().length > 0) {
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th style="width: 10%;">#</th>
                <th style="width: 30%;">Tên Phòng Ban</th>
                <th style="width: 40%;">Mô Tả</th>
                <th style="width: 10%;" class="text-center">Số Nhân Viên</th>
                <th style="width: 10%;" class="text-center">Thao Tác</th>
              </tr>
            </thead>
            <tbody>
              @for (phongBan of phongBans(); track phongBan.id; let idx = $index) {
                <tr>
                  <td>{{ (pageNumber() - 1) * pageSize() + idx + 1 }}</td>
                  <td>
                    <strong>{{ phongBan.tenPhongBan }}</strong>
                  </td>
                  <td>
                    <span class="text-muted">{{ phongBan.moTa || 'Chưa có mô tả' }}</span>
                  </td>
                  <td class="text-center">
                    <span class="badge bg-info">{{ phongBan.soLuongNhanVien }}</span>
                  </td>
                  <td class="text-center">
                    <div class="btn-group btn-group-sm" role="group">
                      <button 
                        class="btn btn-outline-warning" 
                        (click)="openEditModal(phongBan)"
                        title="Chỉnh sửa"
                      >
                        <i class="bi bi-pencil-fill"></i>
                      </button>
                      <button 
                        class="btn btn-outline-danger" 
                        (click)="deletePhongBan(phongBan)"
                        title="Xóa"
                      >
                        <i class="bi bi-trash-fill"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <div class="text-muted">
            Hiển thị {{ Math.min((pageNumber() - 1) * pageSize() + 1, totalCount()) }} 
            - {{ Math.min(pageNumber() * pageSize(), totalCount()) }} 
            trong tổng số {{ totalCount() }} phòng ban
          </div>
          
          @if (totalPages() > 1) {
            <nav>
              <ul class="pagination mb-0">
                <li class="page-item" [class.disabled]="pageNumber() === 1">
                  <button 
                    class="page-link" 
                    (click)="onPageChange(pageNumber() - 1)"
                    [disabled]="pageNumber() === 1"
                  >
                    <i class="bi bi-chevron-left"></i>
                  </button>
                </li>
                
                @for (page of pages; track page) {
                  @if (page === 1 || page === totalPages() || (page >= pageNumber() - 2 && page <= pageNumber() + 2)) {
                    <li class="page-item" [class.active]="page === pageNumber()">
                      <button 
                        class="page-link" 
                        (click)="onPageChange(page)"
                      >
                        {{ page }}
                      </button>
                    </li>
                  } @else if (page === pageNumber() - 3 || page === pageNumber() + 3) {
                    <li class="page-item disabled">
                      <span class="page-link">...</span>
                    </li>
                  }
                }
                
                <li class="page-item" [class.disabled]="pageNumber() === totalPages()">
                  <button 
                    class="page-link" 
                    (click)="onPageChange(pageNumber() + 1)"
                    [disabled]="pageNumber() === totalPages()"
                  >
                    <i class="bi bi-chevron-right"></i>
                  </button>
                </li>
              </ul>
            </nav>
          }
        </div>
      } @else {
        <div class="text-center py-5">
          <i class="bi bi-inbox display-1 text-muted"></i>
          <p class="mt-3 text-muted">
            @if (searchTerm()) {
              Không tìm thấy phòng ban phù hợp với từ khóa "{{ searchTerm() }}"
            } @else {
              Chưa có phòng ban nào trong hệ thống
            }
          </p>
        </div>
      }
    </div>
  </div>
</div>
